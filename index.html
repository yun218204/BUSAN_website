<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BUSAN</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
    />
    <link rel="stylesheet" href="05.css" />
  </head>
  <style>
    @media (max-width: 768px) {
      .nav-bar {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .nav-bar a {
        width: 100%;
        text-align: center;
      }
      .sidebar-text {
        width: 50% !important;
      }
      .sidebar-text h2 {
        font-size: 1rem !important;
      }
      .sidebar {
        border-right: none !important;
      }
      .sidebar h3 {
        display: none;
      }
      .vertical-text {
        writing-mode: vertical-rl;
        font-size: 1rem !important;
      }
      .text {
        display: none;
      }
      .social-icons {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }
      .social-icons a i {
        font-size: 1.5rem;
        padding: 0.5rem;
      }
    }
    @media (max-width: 576px) {
      .modal-dialog {
        max-width: 90%;
      }
    }
  </style>
  <body>
    <!-- æŠ˜åƒ¹åˆ¸å½ˆçª— -->
    <div id="coupon-popup" class="popup-overlay">
      <div class="popup">
        <button class="close-btn">&times;</button>
        <h2>ğŸ‰ é™æ™‚å„ªæƒ ï¼ç«‹å³ç™»å…¥é ˜å–æŠ˜åƒ¹åˆ¸ ğŸŸï¸</h2>
        <p>ç¾åœ¨è¨»å†Šæˆ–ç™»å…¥ï¼Œå³å¯ç²å¾— **$200 æ—…éŠæŠ˜åƒ¹åˆ¸**ï¼</p>
        <!-- åŸæœ¬æ­¤æŒ‰éˆ•æœƒç›´æ¥å°å‘é¦–é ç¾æ”¹ç‚ºè§¸ç™¼æœƒå“¡ç™»å…¥ modal -->
        <button class="btn btn-primary" id="coupon-login-btn">ç«‹å³é ˜å–</button>
      </div>
    </div>
    <img id="bg-image" src="./img/ZhenhaiPort_Fes.jpg" alt="bg" class="bg" />
    <header>
      <nav class="nav-bar">
        <a href="./about.html">é—œæ–¼æˆ‘å€‘</a>
        <a href="./å¿ƒå¾—åˆ†äº«.html">å¿ƒå¾—åˆ†äº«</a>
        <a href="./æ¢ç´¢.html">æ¢ç´¢æ—…éŠ</a>
        <a href="./è¨‚è£½.html">è¨‚è£½æ—…éŠ</a>
        <a href="#" class="btn" id="tour-btn">å‡ºåœ˜è¡¨</a>
        <!-- æ–°å¢æœƒå“¡ç™»å…¥æŒ‰éˆ• -->
        <a href="#" class="btn" id="member-login-btn">æœƒå“¡ç™»å…¥</a>
        <span class="sign">
          <span id="user-greeting" style="color: #2575fc"></span>
          <button
            id="logout-btn"
            class="btn btn-outline-danger btn-sm"
            style="margin-left: 10px; display: none"
          >
            ç™»å‡º
          </button>
        </span>
      </nav>
    </header>
    <!-- å‡ºåœ˜è¡¨  -->
    <div class="modal fade" id="tourModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">å‡ºåœ˜è¡¨</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <ul class="list-group" id="tour-list"></ul>
          </div>
        </div>
      </div>
    </div>

    <!-- æœƒå“¡ç™»å…¥ -->
    <!-- æœƒå“¡ç™»å…¥ Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">æœƒå“¡ç™»å…¥</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="login-form">
              <div class="mb-3">
                <label for="login-username" class="form-label">å¸³è™Ÿ</label>
                <input
                  type="text"
                  class="form-control"
                  id="login-username"
                  name="username"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="login-password" class="form-label">å¯†ç¢¼</label>
                <input
                  type="password"
                  class="form-control"
                  id="login-password"
                  name="password"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary w-100">ç™»å…¥</button>
            </form>

            <hr />
            <p class="text-center mt-3">é‚„æ²’æœ‰æœƒå“¡å¸³è™Ÿï¼Ÿ</p>
            <button class="btn btn-secondary w-100" id="open-register-modal">
              è¨»å†Šå¸³è™Ÿ
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- æœƒå“¡è¨»å†Š Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">æœƒå“¡è¨»å†Š</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form id="register-form">
              <div class="mb-3">
                <label for="reg-username" class="form-label">å¸³è™Ÿ</label>
                <input
                  type="text"
                  class="form-control"
                  id="reg-username"
                  placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="reg-password" class="form-label">å¯†ç¢¼</label>
                <input
                  type="password"
                  class="form-control"
                  id="reg-password"
                  placeholder="è«‹è¼¸å…¥å¯†ç¢¼"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="reg-phone" class="form-label">é›»è©±</label>
                <input
                  type="tel"
                  class="form-control"
                  id="reg-phone"
                  placeholder="è«‹è¼¸å…¥é›»è©±"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="reg-email" class="form-label">Email</label>
                <input
                  type="email"
                  class="form-control"
                  id="reg-email"
                  placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶"
                  required
                />
              </div>
              <button type="submit" class="btn btn-primary">è¨»å†Š</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <main>
      <div class="sidebar">
        <h3 class="vertical-text">å–œæ­¡æ—…è¡Œ</h3>
        <div class="social-icons">
          <a href="#"><i class="bi bi-facebook"></i></a>
          <a href="#"><i class="bi bi-instagram"></i></a>
          <a href="#"><i class="bi bi-line"></i></a>
        </div>
        <div class="contact">
          <a href="./contact.html">è¯çµ¡æˆ‘å€‘</a>
        </div>
      </div>
      <div class="sidebar-text">
        <h4>æ«»èŠ±ä¸»é¡Œç‰¹åˆ¥ä¼åŠƒ</h4>
        <h2>çµ•ç¾é‡œå±±ï¼Œé«”é©—åœ¨åœ°ç¾é£Ÿã€é¢¨æƒ…</h2>
        <p>æ²‰æµ¸æ–¼æµªæ¼«æ«»èŠ±ä¹‹ä¸­ï¼Œæ„Ÿå—é‡œå±±çš„æ˜¥æ—¥é­…åŠ›</p>
        <a href="#" class="more-link"
          >é»æˆ‘äº†è§£æ›´å¤š<i class="bi bi-arrow-right-circle"></i
        ></a>
      </div>
      <h1 class="vertical-text">æµªæ¼«é‡œå±±</h1>
      <h2 class="text">BUSAN</h2>
    </main>

    <!-- æŠ˜åƒ¹åˆ¸å½ˆçª—èˆ‡å‡ºåœ˜è¡¨ -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // æŠ˜åƒ¹åˆ¸å½ˆçª—
        const popup = document.getElementById("coupon-popup");
        const closeBtn = document.querySelector(".close-btn");
        const couponLoginBtn = document.getElementById("coupon-login-btn");

        setTimeout(() => {
          popup.style.display = "flex";
        }, 1500);

        closeBtn.addEventListener("click", function () {
          popup.style.display = "none";
        });

        couponLoginBtn.addEventListener("click", function () {
          fetch("check.php")
            .then((res) => res.json())
            .then((data) => {
              if (data.status === "logged_in") {
                alert("ğŸ‰ å·²ç™»å…¥ï¼ŒæŠ˜åƒ¹åˆ¸é ˜å–æˆåŠŸï¼");
                // é—œæ‰å½ˆçª—
                document.getElementById("coupon-popup").style.display = "none";
              } else {
                document.getElementById("coupon-popup").style.display = "none";
                new bootstrap.Modal(
                  document.getElementById("registerModal")
                ).show();
              }
            })
            .catch((err) => {
              console.error("ç™»å…¥ç‹€æ…‹æª¢æŸ¥éŒ¯èª¤ï¼š", err);
            });
        });

        // å‡ºåœ˜è¡¨è³‡æ–™ç”Ÿæˆ
        const tourBtn = document.getElementById("tour-btn");
        const tourList = document.getElementById("tour-list");

        const getMonthTourData = () => {
          const daysInMonth = new Date(2025, 2, 0).getDate(); // 2æœˆ
          let tourData = [];

          for (let day = 1; day <= daysInMonth; day++) {
            const status =
              Math.random() > 0.5
                ? `é‚„æœ‰ ${Math.floor(Math.random() * 5) + 1} åœ˜å¯å ±å`
                : "é¡æ»¿";
            tourData.push({
              date: `2/${day}`,
              status: status,
              full: status === "é¡æ»¿",
            });
          }
          return tourData;
        };

        const tourData = getMonthTourData();

        tourBtn.addEventListener("click", function () {
          tourList.innerHTML = "";
          tourData.forEach((tour) => {
            const listItem = document.createElement("li");
            listItem.className = `list-group-item ${
              tour.full ? "text-danger" : "text-success"
            }`;
            listItem.textContent = `${tour.date} - ${tour.status}`;
            tourList.appendChild(listItem);
          });
          new bootstrap.Modal(document.getElementById("tourModal")).show();
        });

        // æœƒå“¡ç™»å…¥èˆ‡è¨»å†Š modal æ§åˆ¶
        const memberLoginBtn = document.getElementById("member-login-btn");
        const loginModalEl = document.getElementById("loginModal");
        const registerModalEl = document.getElementById("registerModal");
        const openRegisterModalBtn = document.getElementById(
          "open-register-modal"
        );

        const loginModal = new bootstrap.Modal(loginModalEl);
        const registerModal = new bootstrap.Modal(registerModalEl);

        memberLoginBtn.addEventListener("click", function (e) {
          e.preventDefault();
          loginModal.show();
        });

        openRegisterModalBtn.addEventListener("click", function () {
          loginModal.hide();
          registerModal.show();
        });

        // èƒŒæ™¯åœ–ç‰‡
        fetch("img.php")
          .then((response) => response.json())
          .then((data) => {
            if (data.img_url) {
              document.getElementById("bg-image").src = data.img_url;
            }
          });

        // è‡ªå‹•æª¢æŸ¥ç™»å…¥ç‹€æ…‹
        fetch("check.php")
          .then((res) => res.json())
          .then((data) => {
            if (data.status === "logged_in") {
              updateHeaderAfterLogin(data.username);
            }
          });

        // é¡¯ç¤ºç™»å…¥å¾Œæ­¡è¿èª
        function updateHeaderAfterLogin(username) {
          const signDiv = document.querySelector(".sign");
          const loginBtn =
            document.getElementById("member-login-btn") ||
            document.getElementById("member-link");
          const logoutBtn = document.getElementById("logout-btn");
          const greeting = document.getElementById("user-greeting");

          if (signDiv && greeting) {
            greeting.innerHTML = `${username} ä½ å¥½`;
          }

          if (loginBtn) {
            loginBtn.style.display = "none";
          }

          if (logoutBtn) {
            logoutBtn.style.display = "inline-block";
          }
        }

        // ç™»å…¥è¡¨å–®é€å‡º
        document
          .getElementById("login-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            const username = document.getElementById("login-username").value;
            const password = document.getElementById("login-password").value;

            const formData = new FormData();
            formData.append("username", username);
            formData.append("password", password);

            fetch("login.php", {
              method: "POST",
              body: formData,
            })
              .then((res) => res.json())
              .then((data) => {
                if (data.status === "success") {
                  alert("ç™»å…¥æˆåŠŸï¼");
                  updateHeaderAfterLogin(data.username);
                  bootstrap.Modal.getInstance(
                    document.getElementById("loginModal")
                  ).hide();
                } else {
                  alert("ç™»å…¥å¤±æ•—ï¼š" + data.message);
                }
              })
              .catch((err) => {
                console.error("ç™»å…¥éŒ¯èª¤ï¼š", err);
              });
          });

        // è¨»å†Šè¡¨å–®é€å‡º
        document
          .getElementById("register-form")
          .addEventListener("submit", function (e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append(
              "reg-username",
              document.getElementById("reg-username").value
            );
            formData.append(
              "reg-password",
              document.getElementById("reg-password").value
            );
            formData.append(
              "reg-phone",
              document.getElementById("reg-phone").value
            );
            formData.append(
              "reg-email",
              document.getElementById("reg-email").value
            );

            fetch("register.php", {
              method: "POST",
              body: formData,
            })
              .then((res) => res.json())
              .then((data) => {
                if (data.status === "success") {
                  alert("è¨»å†ŠæˆåŠŸï¼Œè«‹ç™»å…¥ï¼");
                  bootstrap.Modal.getInstance(
                    document.getElementById("registerModal")
                  ).hide();
                  loginModal.show();
                } else {
                  alert("è¨»å†Šå¤±æ•—ï¼š" + data.message);
                }
              })
              .catch((err) => {
                console.error("è¨»å†ŠéŒ¯èª¤ï¼š", err);
              });
          });
      });
      //ç™»å‡º
      const logoutBtn = document.getElementById("logout-btn");
      if (logoutBtn) {
        logoutBtn.addEventListener("click", function () {
          fetch("logout.php")
            .then((res) => res.json())
            .then((data) => {
              if (data.status === "logged_out") {
                alert("æ‚¨å·²æˆåŠŸç™»å‡ºï¼");
                location.reload(); // ğŸ” é‡æ–°æ•´ç†é é¢
              }
            })
            .catch((err) => {
              console.error("ç™»å‡ºå¤±æ•—ï¼š", err);
            });
        });
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
